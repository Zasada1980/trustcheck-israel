# ×¢×•×¡×§ ××•×¨×©×” (VAT Registered Dealers) - Ğ˜ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸ĞºĞ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

## ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°
**ĞšÑ€Ğ¸Ñ‚Ğ¸Ñ‡Ğ½Ğ¾:** Companies Registry (data.gov.il) ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ñ‚ Ğ¢ĞĞ›Ğ¬ĞšĞ ×—×‘×¨×•×ª Ğ±×¢"× (HP Ğ½Ğ°Ñ‡Ğ¸Ğ½Ğ°ÑÑ‚ÑÑ Ğ½Ğ° 5).
Ğ”Ğ»Ñ ×¢×•×¡×§ ××•×¨×©×” Ğ½ÑƒĞ¶Ğ½Ñ‹ HP Ğ½Ğ¾Ğ¼ĞµÑ€Ğ° **ĞĞ• Ğ½Ğ°Ñ‡Ğ¸Ğ½Ğ°ÑÑ‰Ğ¸ĞµÑÑ Ğ½Ğ° 5** (Ğ¸Ğ½Ğ´Ğ¸Ğ²Ğ¸Ğ´ÑƒĞ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ¿Ñ€ĞµĞ´Ğ¿Ñ€Ğ¸Ğ½Ğ¸Ğ¼Ğ°Ñ‚ĞµĞ»Ğ¸).

## ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»Ğ¾ ĞºĞ»Ğ°ÑÑĞ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ğ¸
```
HP Ğ½Ğ°Ñ‡Ğ¸Ğ½Ğ°ĞµÑ‚ÑÑ Ğ½Ğ° 5 â†’ ×—×‘×¨×” ×‘×¢"× (Ltd company)
HP ĞĞ• Ğ½Ğ°Ñ‡Ğ¸Ğ½Ğ°ĞµÑ‚ÑÑ Ğ½Ğ° 5 â†’ ×¢×•×¡×§ ××•×¨×©×” Ğ¸Ğ»Ğ¸ ×¢×•×¡×§ ×¤×˜×•×¨ (individual business)
```

---

## Ğ˜ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸ĞºĞ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ´Ğ»Ñ ×¢×•×¡×§ ××•×¨×©×”

### 1. **Tax Authority API** (ĞÑ„Ğ¸Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸Ğº) â­
**URL:** `https://taxevat.mof.gov.il/`
**Ğ¢Ñ€ĞµĞ±Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ:** 
- Ğ ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ ĞºĞ°Ğº "Beit Tochna" (Software House)
- OAuth2 authentication
- ĞŸÑ€Ğ¾Ñ†ĞµÑÑ Ğ·Ğ°Ğ½Ğ¸Ğ¼Ğ°ĞµÑ‚ 2-4 Ğ½ĞµĞ´ĞµĞ»Ğ¸

**Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ:**
- âœ… ĞŸĞ¾Ğ»Ğ½Ñ‹Ğ¹ ÑĞ¿Ğ¸ÑĞ¾Ğº ×¢×•×¡×§ ××•×¨×©×” Ñ HP Ğ½Ğ¾Ğ¼ĞµÑ€Ğ°Ğ¼Ğ¸
- âœ… VAT numbers (××¡×¤×¨ ×¢×•×¡×§)
- âœ… Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸
- âœ… Ğ”Ğ°Ñ‚Ñ‹ Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸/Ğ¾Ñ‚Ğ¼ĞµĞ½Ñ‹

**ĞŸÑ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚:** P0 - ĞÑ„Ğ¸Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸Ğº

---

### 2. **Scraping: Tax Authority Public Search**
**URL:** `https://taxevat.mof.gov.il/tevat/`
**ĞœĞµÑ‚Ğ¾Ğ´:** Puppeteer/Playwright scraping

**ĞŸÑ€Ğ¾Ñ†ĞµÑÑ:**
1. Ğ¡Ğ³ĞµĞ½ĞµÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ ÑĞ¿Ğ¸ÑĞ¾Ğº HP Ğ½Ğ¾Ğ¼ĞµÑ€Ğ¾Ğ² ĞĞ• Ğ½Ğ° 5 (Ğ¿Ñ€ĞµÑ„Ğ¸ĞºÑÑ‹: 0-4, 6-9)
2. Ğ”Ğ»Ñ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ HP: Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ ÑÑƒÑ‰ĞµÑÑ‚Ğ²Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ‡ĞµÑ€ĞµĞ· Ñ„Ğ¾Ñ€Ğ¼Ñƒ Ğ¿Ğ¾Ğ¸ÑĞºĞ°
3. Ğ˜Ğ·Ğ²Ğ»ĞµÑ‡ÑŒ: ÑÑ‚Ğ°Ñ‚ÑƒÑ VAT, Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ, Ğ°Ğ´Ñ€ĞµÑ

**Ğ¡Ğ»Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚ÑŒ:**
- âš ï¸ CAPTCHA protection
- âš ï¸ Rate limiting
- âš ï¸ ~100M Ğ¿Ğ¾Ñ‚ĞµĞ½Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ñ‹Ñ… ĞºĞ¾Ğ¼Ğ±Ğ¸Ğ½Ğ°Ñ†Ğ¸Ğ¹ HP

**ĞŸÑ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚:** P2 - Ğ ĞµĞ·ĞµÑ€Ğ²Ğ½Ñ‹Ğ¹ Ğ¼ĞµÑ‚Ğ¾Ğ´

---

### 3. **Data.gov.il: Business Licenses Dataset**
**URL:** `https://data.gov.il/dataset/business_licenses`
**Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚:** CSV/JSON

**Ğ¡Ğ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ñ‚:**
- Ğ›Ğ¸Ñ†ĞµĞ½Ğ·Ğ¸Ğ¸ Ğ½Ğ° Ğ±Ğ¸Ğ·Ğ½ĞµÑ (ristuyim)
- HP Ğ½Ğ¾Ğ¼ĞµÑ€Ğ° Ğ²Ğ»Ğ°Ğ´ĞµĞ»ÑŒÑ†ĞµĞ²
- Ğ¢Ğ¸Ğ¿Ñ‹ Ğ±Ğ¸Ğ·Ğ½ĞµÑĞ°

**ĞĞ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ¸Ñ:**
- âŒ ĞĞ• Ğ²ÑĞµ ×¢×•×¡×§ ××•×¨×©×” Ğ¸Ğ¼ĞµÑÑ‚ Ğ»Ğ¸Ñ†ĞµĞ½Ğ·Ğ¸Ğ¸
- âŒ ĞœĞ¾Ğ¶ĞµÑ‚ Ğ±Ñ‹Ñ‚ÑŒ ÑƒÑÑ‚Ğ°Ñ€ĞµĞ²ÑˆĞ¸Ğ¼

**ĞŸÑ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚:** P3 - Ğ”Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸Ğº

---

### 4. **OpenData: Ministry of Economy**
**URL:** `https://economy.gov.il/opendata`
**Datasets:** Grants, subsidies, government contracts

**ĞœĞ¾Ğ¶ĞµÑ‚ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ°Ñ‚ÑŒ:**
- HP Ğ½Ğ¾Ğ¼ĞµÑ€Ğ° Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ°Ñ‚ĞµĞ»ĞµĞ¹ Ğ³Ñ€Ğ°Ğ½Ñ‚Ğ¾Ğ²
- ĞšĞ¾Ğ½Ñ‚Ñ€Ğ°ĞºÑ‚Ñ‹ Ñ Ğ¸Ğ½Ğ´Ğ¸Ğ²Ğ¸Ğ´ÑƒĞ°Ğ»ÑŒĞ½Ñ‹Ğ¼Ğ¸ Ğ¿Ñ€ĞµĞ´Ğ¿Ñ€Ğ¸Ğ½Ğ¸Ğ¼Ğ°Ñ‚ĞµĞ»ÑĞ¼Ğ¸

**ĞŸÑ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚:** P3 - Ğ”Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸Ğº

---

### 5. **Court Rulings (Nevo/Takdin)** ğŸ”„
**Ğ˜ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸ĞºĞ¸:**
- `https://www.nevo.co.il/` - Legal database
- `https://www.takdin.co.il/` - Court decisions

**ĞœĞµÑ‚Ğ¾Ğ´:** Scraping ÑƒĞ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°Ğ½Ğ¸Ğ¹ HP Ğ½Ğ¾Ğ¼ĞµÑ€Ğ¾Ğ² Ğ² ÑÑƒĞ´ĞµĞ±Ğ½Ñ‹Ñ… Ğ´ĞµĞ»Ğ°Ñ…

**ĞĞ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ¸Ñ:**
- âš ï¸ ĞĞµÑ‚ Ğ¿Ñ€ÑĞ¼Ğ¾Ğ³Ğ¾ API
- âš ï¸ Ğ¢Ñ€ĞµĞ±ÑƒĞµÑ‚ÑÑ NLP Ğ´Ğ»Ñ Ğ¸Ğ·Ğ²Ğ»ĞµÑ‡ĞµĞ½Ğ¸Ñ
- âš ï¸ Ğ§Ğ°ÑÑ‚Ğ¸Ñ‡Ğ½Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ

**ĞŸÑ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚:** P4 - ĞĞ¸Ğ·ĞºĞ¸Ğ¹ Ğ¿Ñ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚

---

## Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµĞ¼Ğ°Ñ ÑÑ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ñ

### ĞĞµĞ¼ĞµĞ´Ğ»ĞµĞ½Ğ½Ğ¾ (ÑĞµĞ³Ğ¾Ğ´Ğ½Ñ):
```bash
# 1. Ğ¡ĞºĞ°Ñ‡Ğ°Ñ‚ÑŒ Business Licenses dataset
curl "https://data.gov.il/api/3/action/datastore_search?resource_id=..." -o business_licenses.csv

# 2. Ğ˜Ğ·Ğ²Ğ»ĞµÑ‡ÑŒ HP Ğ½Ğ¾Ğ¼ĞµÑ€Ğ° ĞĞ• Ğ½Ğ° 5
awk -F',' '$1 !~ /^5/ {print $1}' business_licenses.csv > hp_not_5.txt
```

### ĞšÑ€Ğ°Ñ‚ĞºĞ¾ÑÑ€Ğ¾Ñ‡Ğ½Ğ¾ (1-2 Ğ½ĞµĞ´ĞµĞ»Ğ¸):
1. **ĞŸĞ¾Ğ´Ğ°Ñ‚ÑŒ Ğ·Ğ°ÑĞ²ĞºÑƒ Ğ½Ğ° Tax Authority API:**
   - Ğ—Ğ°Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ÑŒ Ñ„Ğ¾Ñ€Ğ¼Ñƒ: https://govextra.gov.il/taxes/innovation/
   - Ğ£ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ñ†ĞµĞ»ÑŒ: "Business reliability verification platform"
   - ĞĞ¶Ğ¸Ğ´Ğ°Ñ‚ÑŒ OAuth2 credentials

2. **Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ scraper Ğ´Ğ»Ñ taxevat.mof.gov.il:**
   ```typescript
   // scripts/scrape_vat_dealers.ts
   async function checkVATStatus(hpNumber: string) {
     // Puppeteer logic Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ ÑÑ‚Ğ°Ñ‚ÑƒÑĞ°
     const page = await browser.newPage();
     await page.goto('https://taxevat.mof.gov.il/tevat/');
     await page.type('#hp_input', hpNumber);
     // Extract result
   }
   ```

### Ğ”Ğ¾Ğ»Ğ³Ğ¾ÑÑ€Ğ¾Ñ‡Ğ½Ğ¾ (1-2 Ğ¼ĞµÑÑÑ†Ğ°):
1. **Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Tax Authority API** (Ğ¿Ğ¾ÑĞ»Ğµ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ñ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ°)
2. **ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ°Ñ ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ** (webhook Ğ¸Ğ»Ğ¸ polling)

---

## Ğ’Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ¾Ğµ Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ (MVP)

**Ğ”Ğ»Ñ Phase 1 (Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ğ¹ MVP):**
Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ **inference Ğ½Ğ° Ğ¾ÑĞ½Ğ¾Ğ²Ğµ company_type**:

```typescript
// lib/vat_dealer.ts - CURRENT LOGIC (CORRECT)
const firstDigit = hpStr.charAt(0);

if (firstDigit === '5') {
  dealerType = '×—×‘×¨×” ×‘×¢"×';
  isVATRegistered = true;
} else {
  // HP doesn't start with 5 â†’ individual business
  const isPartnership = companyType.includes('×©×•×ª×¤×•×ª');
  
  if (isPartnership) {
    dealerType = '×¢×•×¡×§ ××•×¨×©×”';
    isVATRegistered = true;
  } else {
    dealerType = '×¢×•×¡×§ ×¤×˜×•×¨';
    isVATRegistered = false; // Default: assume exempt
  }
}
```

**ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°:** Ğ’ Ñ‚ĞµĞºÑƒÑ‰ĞµĞ¹ Ğ±Ğ°Ğ·Ğµ companies_registry **ĞĞ•Ğ¢** HP Ğ½Ğµ Ğ½Ğ° 5, Ğ¿Ğ¾ÑÑ‚Ğ¾Ğ¼Ñƒ:
- âœ… 716,714 Ğ·Ğ°Ğ¿Ğ¸ÑĞµĞ¹ = Ğ²ÑĞµ ×—×‘×¨×” ×‘×¢"× (100%)
- âŒ 0 Ğ·Ğ°Ğ¿Ğ¸ÑĞµĞ¹ ×¢×•×¡×§ ××•×¨×©×”/×¤×˜×•×¨

---

## Action Items

### P0 - Critical (Today):
- [ ] Ğ˜ÑÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ñ‚ÑŒ data.gov.il Ğ´Ğ»Ñ Ğ´Ğ°Ñ‚Ğ°ÑĞµÑ‚Ğ¾Ğ² Ñ HP Ğ½Ğµ Ğ½Ğ° 5
- [ ] Ğ¡ĞºĞ°Ñ‡Ğ°Ñ‚ÑŒ Business Licenses dataset
- [ ] Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñƒ `osek_morsheh` Ğ² PostgreSQL

### P1 - High Priority (This Week):
- [ ] ĞŸĞ¾Ğ´Ğ°Ñ‚ÑŒ Ğ·Ğ°ÑĞ²ĞºÑƒ Ğ½Ğ° Tax Authority API access
- [ ] Ğ Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ñ‚ÑŒ scraper prototype Ğ´Ğ»Ñ taxevat.mof.gov.il
- [ ] Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ‚Ğ¾Ñ€ Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ½Ñ‹Ñ… HP Ğ½Ğ¾Ğ¼ĞµÑ€Ğ¾Ğ² (checksum algorithm)

### P2 - Medium Priority (2-4 Weeks):
- [ ] Ğ¡Ğ¾Ğ±Ñ€Ğ°Ñ‚ÑŒ HP Ğ½Ğ¾Ğ¼ĞµÑ€Ğ° Ğ¸Ğ· OpenData (economy.gov.il)
- [ ] Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ scraping Ğ² Ğ½Ğ¾Ñ‡Ğ½Ğ¾Ğ¹ batch job
- [ ] Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€ Ğ² unified_data.ts Ğ´Ğ»Ñ ×¢×•×¡×§ ××•×¨×©×”

---

## PostgreSQL Schema Ğ´Ğ»Ñ ×¢×•×¡×§ ××•×¨×©×”

```sql
CREATE TABLE osek_morsheh (
  hp_number BIGINT PRIMARY KEY,
  business_name TEXT,
  dealer_type VARCHAR(50) DEFAULT '×¢×•×¡×§ ××•×¨×©×”',
  is_vat_registered BOOLEAN DEFAULT true,
  vat_number VARCHAR(20), -- ××¡×¤×¨ ×¢×•×¡×§ ×‘×¢×¡×§××•×ª (VAT ID)
  registration_date DATE,
  tax_status VARCHAR(20) DEFAULT 'active', -- active/cancelled/suspended
  business_type TEXT, -- ×¡×•×’ ×¢×¡×§
  city TEXT,
  address TEXT,
  phone VARCHAR(20),
  
  -- Metadata
  data_source VARCHAR(50), -- 'tax_authority', 'scraping', 'business_licenses'
  last_verified_at TIMESTAMPTZ DEFAULT NOW(),
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW(),
  
  CONSTRAINT osek_hp_not_5 CHECK (hp_number::TEXT NOT LIKE '5%')
);

CREATE INDEX idx_osek_tax_status ON osek_morsheh(tax_status);
CREATE INDEX idx_osek_city ON osek_morsheh(city);
CREATE INDEX idx_osek_data_source ON osek_morsheh(data_source);
```

---

## Next Steps

1. **Ğ—Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ Ğ¸ÑÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ data.gov.il:**
   ```bash
   pwsh scripts/research_data_gov_osek.ps1
   ```

2. **Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ¿Ñ€Ğ¾Ñ‚Ğ¾Ñ‚Ğ¸Ğ¿ scraper:**
   ```bash
   npx tsx scripts/scrape_tax_authority.ts --test-hp=123456789
   ```

3. **ĞšĞ¾Ğ³Ğ´Ğ° Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ğ¼ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ:** ĞĞ±Ğ¾Ğ³Ğ°Ñ‚Ğ¸Ñ‚ÑŒ unified_data.ts Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ¸ Ğ¾Ğ±Ğ¾Ğ¸Ñ… Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸ĞºĞ¾Ğ²

---

**Last Updated:** 25.12.2025
**Status:** Research & Planning Phase
