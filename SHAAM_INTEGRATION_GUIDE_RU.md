# Руководство по интеграции SHAAM - TrustCheck Israel

**Дата:** 29 декабря 2025  
**Источник:** https://www.gov.il/he/service/connect-to-shaam  
**Статус:** Фаза планирования - ожидание одобрения

---

## Обзор

**SHAAM (שירותי המכון הממשלתי למידע)** - платформа правительственных информационных служб Израиля, предоставляющая официальный доступ к государственным базам данных через API.

**Для TrustCheck Israel:** Это официальный, легальный способ доступа к данным о бизнесе в реальном времени вместо использования:
- Ручных загрузок с data.gov.il (716K компаний, устаревшие)
- Web-скрапинга (юридическая серая зона)
- Фоллбэка на mock-данные

---

## Преимущества интеграции SHAAM

✅ **Юридическое соответствие** - Официальная авторизация от правительства  
✅ **Данные в реальном времени** - Живые запросы вместо кэшированных датасетов  
✅ **Всестороннее покрытие** - Доступ к множеству государственных баз данных  
✅ **Лучшая точность** - Прямой источник без посредников  
✅ **Масштабируемость** - Нет лимитов от web-скрапинга  
✅ **Профессиональная репутация** - Статус официального партнера

---

## Процесс регистрации (קישור בתי תוכנה)

### Шаг 1: Регистрация компании
**Предварительные требования:**
- Регистрация израильской компании (ח.פ. 345033898 ✅)
- Действующая бизнес-лицензия
- Банковский счет компании
- Страховой полис (если требуется)

**Необходимые документы:**
- Свидетельство о регистрации (תעודת התאגדות)
- Бизнес-лицензия (רישיון עסק)
- Устав компании (תקנון)
- Удостоверение личности уполномоченного лица
- Доверенность (если применимо)

### Шаг 2: Заявка на статус программного дома
**Разделы формы заявки:**
1. Реквизиты компании (название, H.P., адрес, контакты)
2. Описание программного обеспечения:
   - **Название продукта:** TrustCheck Israel
   - **Назначение:** Платформа проверки надежности бизнеса
   - **Целевые пользователи:** Родители, потребители, малый бизнес
   - **Ожидаемый объем:** 1,000-5,000 запросов/месяц (Фаза 1)
3. Декларация использования данных
4. Меры безопасности
5. Соответствие конфиденциальности (GDPR + израильское законодательство)

**Подача:** Через портал gov.il или email в офис SHAAM

### Шаг 3: Техническая интеграция
**После одобрения:**
1. Получение API-учетных данных (client_id, client_secret)
2. Доступ к sandbox-окружению
3. API-документация (SOAP/REST)
4. Тестовые учетные данные для разработки
5. Production-учетные данные после тестирования

### Шаг 4: Тестирование и сертификация
- Функциональное тестирование в sandbox (2-4 недели)
- Аудит безопасности
- Проверка соответствия конфиденциальности
- Нагрузочное тестирование (при высоком объеме)
- Финальное одобрение от SHAAM

### Шаг 5: Запуск
- Активация production-учетных данных
- Доступ к панели мониторинга
- Назначение контакта поддержки
- Квартальные отчеты об использовании

---

## Доступные источники данных через SHAAM

### 1. Реестр компаний (רשם החברות)
**База данных:** Министерство юстиции  
**Доступные данные:**
- Название компании, номер H.P., дата регистрации
- Юридический статус (активна/неактивна/ликвидация)
- Тип компании (בע"מ, партнерство, עוסק מורשה)
- Зарегистрированный адрес
- Директора и акционеры
- Уставный капитал
- Статус подачи годовых отчетов

**API-эндпоинты:**
- `/api/companies/search` - Поиск по названию/H.P.
- `/api/companies/{hp}` - Полные данные компании
- `/api/companies/{hp}/directors` - Список директоров
- `/api/companies/{hp}/filings` - История подачи документов

### 2. Налоговое управление (רשות המסים)
**База данных:** Налоговое управление Израиля  
**Доступные данные:**
- Статус НДС (עוסק מורשה/עוסק פטור)
- Статус налогового соответствия
- Статус активности/приостановки
- Дата регистрации

**API-эндпоинты:**
- `/api/vat/verify` - Проверка номера НДС
- `/api/vat/status` - Текущий статус

**Примечание:** Ограниченные данные из-за законов о конфиденциальности. Полные налоговые записи недоступны.

### 3. Судебные дела (נט המשפט)
**База данных:** Судебная система  
**Доступные данные:**
- Гражданские дела (תיקים אזרחיים)
- Уголовные дела (תיקים פליליים)
- Дела трудового суда
- Административные дела
- Статус дела, приговоры, даты

**API-эндпоинты:**
- `/api/courts/search` - Поиск по имени стороны/ID
- `/api/courts/case/{id}` - Детали дела

### 4. Исполнительное производство (הוצאה לפועל)
**База данных:** Судебное управление Израиля  
**Доступные данные:**
- Открытые исполнительные производства
- Данные кредитора/должника
- Сумма задолженности
- Статус дела (активно/закрыто)

**API-эндпоинты:**
- `/api/execution/search` - Поиск по ID/имени должника
- `/api/execution/file/{id}` - Детали дела

### 5. Заблокированные счета (חשבונות מוגבלים)
**База данных:** Банк Израиля  
**Доступные данные:**
- Список бизнесов с заблокированными банковскими счетами
- Причина блокировки
- Дата вступления в силу

**API-эндпоинты:**
- `/api/blocked-accounts/search` - Проверка блокировки счета

---

## Модель ценообразования

**SHAAM взимает плату за API-вызов:**

| Сервис | Стоимость запроса | Примечания |
|---------|------------------|------------|
| Реестр компаний | ₪0.50-₪2.00 | Зависит от глубины данных |
| Налоговое управление | ₪0.30-₪1.00 | Базовая верификация |
| Суды | ₪1.00-₪3.00 | За поиск дела |
| Исполнительное производство | ₪1.00-₪2.00 | За поиск дела |
| Заблокированные счета | ₪0.50 | Простая проверка |

**Ориентировочная стоимость отчета TrustCheck:**
- Базовый отчет (бесплатный): ₪2-₪4 за запрос
- Полный отчет (₪29): ₪5-₪10 за запрос
- Месячная подписка: ₪500-₪2,000 затрат на API

**Влияние на бизнес-модель:**
- Текущее ценообразование устойчиво: отчет за ₪29 покрывает ₪10 API + ₪19 маржа
- Необходима оптимизация: Кэшировать результаты на 30 дней (разрешено лицензией)
- Объемные скидки: Договариваться с SHAAM после 10,000 запросов/месяц

---

## План технической реализации

### Фаза 1: Обновление схемы БД

Создать таблицу `government_api_cache` для минимизации API-затрат:

```sql
CREATE TABLE government_api_cache (
  id SERIAL PRIMARY KEY,
  hp_number BIGINT NOT NULL,
  data_source VARCHAR(50) NOT NULL, -- 'companies_registry', 'vat', 'courts', etc.
  raw_data JSONB NOT NULL,
  cached_at TIMESTAMP DEFAULT NOW(),
  expires_at TIMESTAMP NOT NULL, -- NOW() + 30 days
  api_cost DECIMAL(10,2), -- Отслеживание фактической стоимости
  UNIQUE(hp_number, data_source)
);

CREATE INDEX idx_cache_hp ON government_api_cache(hp_number);
CREATE INDEX idx_cache_expires ON government_api_cache(expires_at);
```

### Фаза 2: Библиотека API-клиента

```typescript
// lib/shaam/client.ts
export class ShaamClient {
  private baseUrl = process.env.SHAAM_API_URL;
  private clientId = process.env.SHAAM_CLIENT_ID;
  private clientSecret = process.env.SHAAM_CLIENT_SECRET;
  
  async authenticate(): Promise<string> {
    // OAuth2 аутентификация
    const response = await fetch(`${this.baseUrl}/oauth/token`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        grant_type: 'client_credentials',
        client_id: this.clientId,
        client_secret: this.clientSecret,
      }),
    });
    const data = await response.json();
    return data.access_token;
  }
  
  async getCompanyDetails(hpNumber: number): Promise<CompanyData> {
    // Сначала проверить кэш
    const cached = await this.getFromCache(hpNumber, 'companies_registry');
    if (cached && cached.expires_at > new Date()) {
      return cached.raw_data;
    }
    
    // Вызвать API если нет в кэше
    const token = await this.authenticate();
    const response = await fetch(`${this.baseUrl}/api/companies/${hpNumber}`, {
      headers: { Authorization: `Bearer ${token}` },
    });
    
    const data = await response.json();
    
    // Кэшировать на 30 дней
    await this.saveToCache(hpNumber, 'companies_registry', data, 30);
    
    return data;
  }
  
  // Аналогичные методы для НДС, судов, исполнительного производства, заблокированных счетов
}
```

### Фаза 3: Обновление unified_data.ts

```typescript
// lib/unified_data.ts
import { ShaamClient } from './shaam/client';

export async function getBusinessData(hpNumber: number) {
  const shaam = new ShaamClient();
  
  try {
    // Сначала попробовать SHAAM (если учетные данные настроены)
    if (process.env.SHAAM_CLIENT_ID) {
      const [company, vat, courts, execution, blocked] = await Promise.all([
        shaam.getCompanyDetails(hpNumber),
        shaam.getVATStatus(hpNumber),
        shaam.searchLegalCases(hpNumber),
        shaam.searchExecutionFiles(hpNumber),
        shaam.checkBlockedAccount(hpNumber),
      ]);
      
      return {
        source: 'shaam_api',
        company,
        vat,
        courts,
        execution,
        blocked,
        cached: false,
      };
    }
  } catch (error) {
    console.error('Ошибка SHAAM API, переход на PostgreSQL', error);
  }
  
  // Фоллбэк на кэш PostgreSQL (текущая реализация)
  return await postgres.searchLocalCompany(hpNumber);
}
```

---

## График и вехи

### Месяц 1: Заявка (январь 2026)
- [ ] Неделя 1-2: Подготовка документов заявки
- [ ] Неделя 3: Подача заявки в SHAAM
- [ ] Неделя 4: Отслеживание, ответы на вопросы

**Результат:** Заявка подана

### Месяц 2-3: Процесс одобрения (февраль-март 2026)
- [ ] Проверка безопасности SHAAM
- [ ] Аудит соответствия конфиденциальности
- [ ] Переговоры по контракту
- [ ] Согласование условий оплаты

**Результат:** Письмо об одобрении + sandbox-учетные данные

### Месяц 4: Интеграция (апрель 2026)
- [ ] Неделя 1: Настройка sandbox-окружения
- [ ] Неделя 2-3: Разработка библиотеки API-клиента
- [ ] Неделя 4: Интеграционное тестирование

**Результат:** Работающая интеграция на staging

### Месяц 5: Тестирование и сертификация (май 2026)
- [ ] Функциональные тесты (все 5 источников данных)
- [ ] Нагрузочное тестирование (1,000 запросов/день)
- [ ] Аудит безопасности
- [ ] Проверка соответствия конфиденциальности

**Результат:** Сертификация SHAAM

### Месяц 6: Запуск в production (июнь 2026)
- [ ] Получены production-учетные данные
- [ ] Развертывание в production
- [ ] Мониторинг API-затрат
- [ ] Приемочное тестирование пользователями

**Результат:** Работа с SHAAM API в production

---

## Анализ затрат

### Затраты на настройку
- Регистрационный взнос: ₪500-₪2,000 (единоразово)
- Аудит безопасности: ₪5,000-₪10,000 (если требуется внешний)
- Разработка: 160 часов @ ₪200/час = ₪32,000
- Тестирование: 40 часов @ ₪200/час = ₪8,000

**Общая настройка: ₪45,500-₪52,000**

### Ежемесячные операционные расходы (Фаза 1: 1,000 отчетов/месяц)
- API-вызовы: 1,000 отчетов × ₪8 средн. = ₪8,000/месяц
- Абонентская плата SHAAM: ₪500-₪1,000/месяц (если применимо)
- Инфраструктура: ₪200/месяц (слой кэширования)

**Всего в месяц: ₪8,700-₪9,200**

### Прогноз доходов (1,000 отчетов/месяц)
- Бесплатные отчеты: 500 × ₪0 = ₪0
- Платные отчеты: 400 × ₪29 = ₪11,600
- Месячные подписки: 10 × ₪99 = ₪990

**Общий доход: ₪12,590/месяц**

**Валовая маржа: ₪12,590 - ₪9,200 = ₪3,390/месяц (27%)**

### Анализ безубыточности
- Затраты на настройку: ₪50,000
- Ежемесячная прибыль: ₪3,390
- **Безубыточность: 15 месяцев**

**Масштабирование до прибыльности:**
- При 2,000 отчетов/месяц: ₪8,000 прибыли/месяц → безубыточность через 6 месяцев
- При 5,000 отчетов/месяц: ₪25,000 прибыли/месяц → безубыточность через 2 месяца

---

## Риски и снижение

### Риск 1: Отклонение заявки
**Вероятность:** Низкая (15%)  
**Влияние:** Высокое  
**Снижение:**
- Консультироваться с SHAAM перед подачей
- Нанять консультанта с опытом работы с правительством
- Фоллбэк: Продолжить с data.gov.il + скрапинг

### Риск 2: Высокие API-затраты
**Вероятность:** Средняя (40%)  
**Влияние:** Высокое  
**Снижение:**
- Реализовать агрессивное кэширование (TTL 30 дней)
- Договариваться об объемных скидках
- Оптимизировать запросы (вызывать только нужные API)
- Ограничение скорости на пользователя

### Риск 3: Длительный процесс одобрения
**Вероятность:** Высокая (60%)  
**Влияние:** Среднее  
**Снижение:**
- Начать заявку ASAP (январь 2026)
- Продолжить Фазу 1 с существующими данными
- Установить ожидания: SHAAM к Фазе 2 (июнь 2026)

### Риск 4: Проблемы технической интеграции
**Вероятность:** Средняя (30%)  
**Влияние:** Среднее  
**Снижение:**
- Заложить дополнительное время разработки (200 часов всего)
- Нанять опытного SHAAM-разработчика как консультанта
- Тщательное тестирование в sandbox

---

## Следующие шаги (немедленно)

### Январь 2026 - Подготовка заявки

**Неделя 1 (1-7 января):**
- [ ] Собрать документы компании (свидетельство о регистрации, устав и т.д.)
- [ ] Составить описание ПО (иврит + английский)
- [ ] Подготовить доказательство политики конфиденциальности (уже готово ✅)
- [ ] Подготовить документ о мерах безопасности

**Неделя 2 (8-14 января):**
- [ ] Связаться с офисом SHAAM для предварительной консультации
- [ ] Тщательно изучить форму заявки
- [ ] Получить юридическую проверку заявки
- [ ] Подготовить одобрение бюджета для API-затрат

**Неделя 3 (15-21 января):**
- [ ] Подать заявку через портал gov.il
- [ ] Email-уведомление контакту SHAAM
- [ ] Настроить систему отслеживания статуса заявки

**Неделя 4 (22-31 января):**
- [ ] Отследить статус заявки
- [ ] Ответить на любые вопросы от SHAAM
- [ ] Начать техническое планирование (в ожидании)

### Параллельная работа (январь-март)

**Фаза 1 продолжается с существующими данными:**
- Завершить интеграцию платежного шлюза (Tranzilla)
- Запустить с кэшем PostgreSQL (716K компаний)
- Построить пользовательскую базу и доход
- Доработать AI-анализ

**Интеграция SHAAM = апгрейд Фазы 2:**
- Пользователи получают данные в реальном времени вместо кэшированных
- Конкурентное преимущество перед платформами с только статическими данными
- Премиум-тариф: "Проверка в реальном времени" по более высокой цене

---

## Контактная информация

**Офис SHAAM:**
- Веб-сайт: https://www.gov.il/he/service/connect-to-shaam
- Email: shaam@economy.gov.il (проверить текущий email)
- Телефон: 02-6662222 (коммутатор Министерства экономики)
- Адрес: Министерство экономики и промышленности, Иерусалим

**Контакт TrustCheck для заявки:**
- Компания: TrustCheck Israel בע"מ
- H.P.: 345033898
- Контактное лицо: Дан Коэн (CEO)
- Email: dan@trustcheck.co.il
- Телефон: 050-123-4567

---

## Требования соответствия

### Ограничения использования данных
- ✅ Можно использовать данные для отчетов клиентам
- ✅ Можно кэшировать на 30 дней (проверить лицензию)
- ❌ Нельзя перепродавать необработанные данные третьим сторонам
- ❌ Нельзя создавать конкурирующий продукт базы данных
- ❌ Нельзя делиться API-учетными данными

### Соответствие конфиденциальности
- Должно соответствовать Закону о защите конфиденциальности Израиля
- Соответствие GDPR для пользователей ЕС
- Безопасное хранение API-учетных данных (зашифровано)
- Аудиторский след всех API-вызовов
- Согласие пользователя на обработку данных

### Требования безопасности
- HTTPS/TLS шифрование для всех API-вызовов
- Безопасное хранение токенов доступа
- Регулярные аудиты безопасности
- План реагирования на инциденты
- Уведомление о утечке данных (72 часа)

---

## Заключение

**Интеграция SHAAM - это долгосрочное решение для TrustCheck Israel.**

**Краткосрочная стратегия (Фаза 1, янв-май 2026):**
- Запуск с кэшем PostgreSQL + data.gov.il
- Построение пользовательской базы и дохода
- Доказательство бизнес-модели

**Долгосрочная стратегия (Фаза 2, июнь 2026+):**
- Миграция на SHAAM API для данных в реальном времени
- Премиум-тариф с "Проверкой в реальном времени"
- Масштабирование до 10,000+ отчетов/месяц
- Статус официального правительственного партнера

**ROI:** Безубыточность через 6-15 месяцев в зависимости от объема. Критически важно для авторитета и долгосрочной устойчивости.

**Следующее действие:** Начать подготовку заявки в январе 2026.

---

**Версия документа:** 1.0  
**Последнее обновление:** 29 декабря 2025  
**Автор:** GitHub Copilot (Claude Sonnet 4.5)  
**Статус:** Документ стратегического планирования
